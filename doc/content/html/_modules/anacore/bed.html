

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>anacore.bed &mdash; AnaCore  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AnaCore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../anacore.html">AnaCore package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AnaCore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>anacore.bed</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for anacore.bed</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Classes and functions for reading/writing/processing BED files.&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Frederic Escudie&#39;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s1">&#39;Copyright (C) 2017 IUCT-O&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s1">&#39;GNU General Public License&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.5.0&#39;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;escudie.frederic@iuct-oncopole.fr&#39;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s1">&#39;prod&#39;</span>

<span class="kn">from</span> <span class="nn">anacore.region</span> <span class="k">import</span> <span class="n">Region</span><span class="p">,</span> <span class="n">RegionList</span>
<span class="kn">from</span> <span class="nn">anacore.abstractFile</span> <span class="k">import</span> <span class="n">AbstractFile</span>


<div class="viewcode-block" id="BEDRecord"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDRecord">[docs]</a><span class="k">class</span> <span class="nc">BEDRecord</span><span class="p">(</span><span class="n">Region</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to manage a BED record.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chrom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thickStart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thickEnd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">itemRgb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blockCount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blockSizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blockStarts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build and return an instance of BEDRecord.</span>

<span class="sd">        :param chrom: The name of the chromosome on which the annotation has been defined.</span>
<span class="sd">        :type chrom: str</span>
<span class="sd">        :param start: The start position on the reference. This position is 1-based and ascending (start &lt;= end).</span>
<span class="sd">        :type start: int</span>
<span class="sd">        :param end: The end position on the reference. This position is 1-based and ascending (start &lt;= end). [Default: start]</span>
<span class="sd">        :type end: int</span>
<span class="sd">        :param name: The name of the annotation.</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param score: A score between 0 and 1000</span>
<span class="sd">        :type score: int</span>
<span class="sd">        :param strand: The strand of the annotation (&quot;+&quot; or &quot;-&quot;).</span>
<span class="sd">        :type strand: str</span>
<span class="sd">        :param thickStart: The starting position at which the feature is drawn thickly (for example, the start codon in gene displays). This position is 1-based and ascending (start &lt;= end).</span>
<span class="sd">        :type thickStart: int</span>
<span class="sd">        :param thickEnd: The ending position at which the feature is drawn thickly (for example the stop codon in gene displays). This position is 1-based and ascending (start &lt;= end).</span>
<span class="sd">        :type thickEnd: int</span>
<span class="sd">        :param itemRgb: An RGB value of the form R,G,B (e.g. 255,0,0).</span>
<span class="sd">        :type itemRgb: list</span>
<span class="sd">        :param blockCount: The number of blocks (exons) in the BED line.</span>
<span class="sd">        :type blockCount: int</span>
<span class="sd">        :param blockSizes: list of the block sizes</span>
<span class="sd">        :type blockSizes: list</span>
<span class="sd">        :param blockStarts: list of block starts. All of the blockStart positions should be calculated relative to chromStart.</span>
<span class="sd">        :type blockStarts: list</span>
<span class="sd">        :return: The new instance.</span>
<span class="sd">        :rtype: BEDRecord</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Region</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">strand</span><span class="p">,</span> <span class="n">chrom</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickStart</span> <span class="o">=</span> <span class="n">thickStart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickEnd</span> <span class="o">=</span> <span class="n">thickEnd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemRgb</span> <span class="o">=</span> <span class="n">itemRgb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockCount</span> <span class="o">=</span> <span class="n">blockCount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockSizes</span> <span class="o">=</span> <span class="n">blockSizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockStarts</span> <span class="o">=</span> <span class="n">blockStarts</span>

    <span class="k">def</span> <span class="nf">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
        <span class="n">attr_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;chrom&quot;</span><span class="p">:</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;reference&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attr_value</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="o">==</span> <span class="s2">&quot;chrom&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setReference</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

<div class="viewcode-block" id="BEDRecord.recFromRegion"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDRecord.recFromRegion">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">recFromRegion</span><span class="p">(</span><span class="n">region_record</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an instance of BEDRecord corresponding to the region_record. The following fields will be None: score, thickStart, thickEnd, itemRgb, blockCount, blockSizes and blockStarts.</span>

<span class="sd">        :param region_record:</span>
<span class="sd">        :type region_record: anacore.region.Region</span>
<span class="sd">        :return: The BEDRecord corresponding to the region_record. The following fields will be None: score, thickStart, thickEnd, itemRgb, blockCount, blockSizes and blockStarts.</span>
<span class="sd">        :rtype: BEDRecord</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BEDRecord</span><span class="p">(</span>
            <span class="n">region_record</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span>
            <span class="n">region_record</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">region_record</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="n">region_record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">region_record</span><span class="o">.</span><span class="n">strand</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="BEDIO"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDIO">[docs]</a><span class="k">class</span> <span class="nc">BEDIO</span><span class="p">(</span><span class="n">AbstractFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to read and write in BED file (https://genome.ucsc.edu/FAQ/FAQformat.html#format1).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">write_nb_col</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build and return an instance of BEDIO.</span>

<span class="sd">        :param filepath: The filepath.</span>
<span class="sd">        :type filepath: str.</span>
<span class="sd">        :param mode: Mode to open the file (&#39;r&#39;, &#39;w&#39;, &#39;a&#39;).</span>
<span class="sd">        :type mode: str.</span>
<span class="sd">        :param write_nb_col: The number of column in BED file when the mode is in [&quot;a&quot;, &quot;w&quot;].</span>
<span class="sd">        :type write_nb_col: int.</span>
<span class="sd">        :return: The new instance.</span>
<span class="sd">        :rtype: BEDIO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AbstractFile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_nb_col</span> <span class="o">=</span> <span class="n">write_nb_col</span>

<div class="viewcode-block" id="BEDIO.BEDRecordToBEDLine"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDIO.BEDRecordToBEDLine">[docs]</a>    <span class="k">def</span> <span class="nf">BEDRecordToBEDLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the record in BED format.</span>

<span class="sd">        :param record: The record to process.</span>
<span class="sd">        :type record: BEDRecord.</span>
<span class="sd">        :return: The BED line corresponding to the record.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">str_fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_nb_col</span><span class="p">)])</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">str_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">record</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span>
            <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">record</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">score</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">strand</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">record</span><span class="o">.</span><span class="n">strand</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">thickStart</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">thickStart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">thickEnd</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">thickEnd</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">itemRgb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">itemRgb</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">blockCount</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">blockCount</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">blockSizes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">blockSizes</span><span class="p">))),</span>
            <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">blockStarts</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">blockStarts</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="BEDIO.isRecordLine"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDIO.isRecordLine">[docs]</a>    <span class="k">def</span> <span class="nf">isRecordLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the line corresponds to a record (it is not a comment or an header line).</span>

<span class="sd">        :param line: The evaluated line.</span>
<span class="sd">        :type line: str.</span>
<span class="sd">        :return: True if the line corresponds to a record.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_record</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;browser &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;track &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
            <span class="n">is_record</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">is_record</span></div>

<div class="viewcode-block" id="BEDIO.isValid"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDIO.isValid">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">isValid</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the file can be a BED file.</span>

<span class="sd">        :return: True if the file can be a BED file.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">BEDIO</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">FH_in</span><span class="p">:</span>
                <span class="n">record_idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">FH_in</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">record_idx</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">strand</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">strand</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">]:</span>  <span class="c1"># Check strand</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                            <span class="s2">&quot;The line </span><span class="si">{}</span><span class="s2"> in </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> cannot be parsed by </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Line content: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">FH_in</span><span class="o">.</span><span class="n">current_line_nb</span><span class="p">,</span> <span class="n">FH_in</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="n">FH_in</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">FH_in</span><span class="o">.</span><span class="n">current_line</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="c1"># if record.itemRgb is not None and len(record.itemRgb.split(&quot;,&quot;)) != 3:</span>
                    <span class="c1">#     raise IOError(</span>
                    <span class="c1">#         &quot;The line {} in \&quot;{}\&quot; cannot be parsed by {}.\nLine content: {}&quot;.format(</span>
                    <span class="c1">#             FH_in.current_line_nb, FH_in.filepath, FH_in.__class__.__name__, FH_in.current_line</span>
                    <span class="c1">#         )</span>
                    <span class="c1">#     )</span>
                    <span class="n">record_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">is_valid</span></div>

    <span class="k">def</span> <span class="nf">_parseLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a structured record from the current line.</span>

<span class="sd">        :return: The record defined by the current line.</span>
<span class="sd">        :rtype: BEDrecord</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">elt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)]</span>
        <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Start in BED is 0-based</span>
        <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">nb_col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nb_col</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># A score between 0 and 1000. If the track line useScore attribute is set to 1 for this annotation data set, the score value will determine the level of gray in which this feature is displayed (higher numbers = darker gray).</span>
            <span class="k">if</span> <span class="n">nb_col</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">fields</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># The starting position at which the feature is drawn thickly (for example, the start codon in gene displays). When there is no thick part, thickStart and thickEnd are usually set to the chromStart position.</span>
                <span class="k">if</span> <span class="n">nb_col</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">fields</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>  <span class="c1"># The ending position at which the feature is drawn thickly (for example the stop codon in gene displays).</span>
                    <span class="k">if</span> <span class="n">nb_col</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">fields</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>  <span class="c1"># The number of blocks (exons) in the BED line.</span>
                        <span class="k">if</span> <span class="n">nb_col</span> <span class="o">&gt;=</span> <span class="mi">11</span><span class="p">:</span>
                            <span class="n">fields</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>  <span class="c1"># A comma-separated list of the block sizes. The number of items in this list should correspond to blockCount.</span>
                            <span class="k">if</span> <span class="n">nb_col</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">:</span>
                                <span class="n">fields</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>  <span class="c1"># A comma-separated list of block starts. All of the blockStart positions should be calculated relative to chromStart. The number of items in this list should correspond to blockCount.</span>
        <span class="k">return</span> <span class="n">BEDRecord</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span>

<div class="viewcode-block" id="BEDIO.write"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDIO.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write record line in file.</span>

<span class="sd">        :param bed: The record to write.</span>
<span class="sd">        :type record: anacore.region.Region</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">BEDRecord</span><span class="p">):</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">BEDRecord</span><span class="o">.</span><span class="n">recFromRegion</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BEDRecordToBEDLine</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line_nb</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="BEDIO.getMaxNbCol"><a class="viewcode-back" href="../../anacore.html#anacore.bed.BEDIO.getMaxNbCol">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getMaxNbCol</span><span class="p">(</span><span class="n">in_bed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the maximum number of fields in BED file. The number of fields per line must be consistent throughout any single set of data in an annotation track.</span>

<span class="sd">        :param in_bed: The path to the file (format: BED).</span>
<span class="sd">        :type in_bed: str</span>
<span class="sd">        :return: The maximum number of fields from the first line of the BED file.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nb_col</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">with</span> <span class="n">BEDIO</span><span class="p">(</span><span class="n">in_bed</span><span class="p">)</span> <span class="k">as</span> <span class="n">FH_in</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">FH_in</span><span class="p">:</span>
                <span class="n">nb_col</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nb_col</span><span class="p">,</span> <span class="n">FH_in</span><span class="o">.</span><span class="n">current_line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">nb_col</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">nb_col</span></div></div>


<div class="viewcode-block" id="getAreas"><a class="viewcode-back" href="../../anacore.html#anacore.bed.getAreas">[docs]</a><span class="k">def</span> <span class="nf">getAreas</span><span class="p">(</span><span class="n">in_bed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the list of areas from a BED file.</span>

<span class="sd">    :param in_bed: The path to the areas description (format: BED).</span>
<span class="sd">    :type in_bed: str</span>
<span class="sd">    :return: The list of areas.</span>
<span class="sd">    :rtype: region.RegionList</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">areas</span> <span class="o">=</span> <span class="n">RegionList</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">BEDIO</span><span class="p">(</span><span class="n">in_bed</span><span class="p">)</span> <span class="k">as</span> <span class="n">FH_panel</span><span class="p">:</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="n">RegionList</span><span class="p">(</span><span class="n">FH_panel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">areas</span></div>


<div class="viewcode-block" id="getAreasByChr"><a class="viewcode-back" href="../../anacore.html#anacore.bed.getAreasByChr">[docs]</a><span class="k">def</span> <span class="nf">getAreasByChr</span><span class="p">(</span><span class="n">in_bed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return by chromosome the list of areas from a BED file.</span>

<span class="sd">    :param in_bed: The path to the areas description (format: BED).</span>
<span class="sd">    :type in_bed: str</span>
<span class="sd">    :return: The list of areas by chromosome (each list is an instance of region.Regionlist).</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">areas_by_chr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">curr_area</span> <span class="ow">in</span> <span class="n">getAreas</span><span class="p">(</span><span class="n">in_bed</span><span class="p">):</span>
        <span class="n">chrom</span> <span class="o">=</span> <span class="n">curr_area</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">chrom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">areas_by_chr</span><span class="p">:</span>
            <span class="n">areas_by_chr</span><span class="p">[</span><span class="n">chrom</span><span class="p">]</span> <span class="o">=</span> <span class="n">RegionList</span><span class="p">()</span>
        <span class="n">areas_by_chr</span><span class="p">[</span><span class="n">chrom</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_area</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">areas_by_chr</span></div>


<div class="viewcode-block" id="getSortedAreasByChr"><a class="viewcode-back" href="../../anacore.html#anacore.bed.getSortedAreasByChr">[docs]</a><span class="k">def</span> <span class="nf">getSortedAreasByChr</span><span class="p">(</span><span class="n">in_bed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return by chromosome the list of sorted areas from a BED file.</span>

<span class="sd">    :param in_bed: The path to the areas description (format: BED).</span>
<span class="sd">    :type in_bed: str</span>
<span class="sd">    :return: The list of sorted areas by chromosome (each list is an instance of region.Regionlist).</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">areas_by_chr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">chrom</span><span class="p">,</span> <span class="n">areas</span> <span class="ow">in</span> <span class="n">getAreasByChr</span><span class="p">(</span><span class="n">in_bed</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">areas_by_chr</span><span class="p">[</span><span class="n">chrom</span><span class="p">]</span> <span class="o">=</span> <span class="n">RegionList</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">areas</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">end</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">areas_by_chr</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Frédéric Escudié

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>